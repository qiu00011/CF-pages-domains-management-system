
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­æ€¡vpné¢æ¿ - ç»¼åˆç®¡ç†ç³»ç»Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; margin: 0; overflow: hidden; }
        .glass {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        .dark .glass {
            background: rgba(30, 30, 30, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        #custom-bg-layer {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -10;
            object-fit: cover;
            transition: opacity 1.5s ease;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.4s ease forwards; }
        .custom-scroll::-webkit-scrollbar { width: 4px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.1); border-radius: 10px; }
        
        /* ç§»åŠ¨ç«¯åº•éƒ¨å¯¼èˆªæ¿€æ´»æ ·å¼ */
        .mobile-nav-active {
            color: #2563eb;
            transform: translateY(-4px);
        }
        .dark .mobile-nav-active {
            color: #60a5fa;
        }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
</head>
<body class="bg-slate-50 text-slate-900 transition-colors duration-500">
    <div id="root"></div>

    <script type="module">
        import { h, Component, render } from 'https://esm.sh/preact';
        import { useState, useEffect, useCallback, useMemo } from 'https://esm.sh/preact/hooks';
        import htm from 'https://esm.sh/htm';

        const html = htm.bind(h);

        const APP_LOGO = "https://image.hyeri.us.kg/icon.png";
        const APP_NAME = "å­æ€¡vpné¢æ¿";

        // --- å­ç»„ä»¶: Login ---
        const Login = ({ onLoginSuccess }) => {
            const [password, setPassword] = useState('');
            const [error, setError] = useState(false);
            const [loading, setLoading] = useState(false);

            const handleLogin = async () => {
                setLoading(true); setError(false);
                try {
                    const resp = await fetch('/api/auth', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ password })
                    });
                    const data = await resp.json();
                    if (data.success) {
                        sessionStorage.setItem('authenticated', 'true');
                        onLoginSuccess();
                    } else { setError(true); }
                } catch (e) { setError(true); } finally { setLoading(false); }
            };

            return html`
                <div class="h-screen w-screen flex items-center justify-center bg-slate-900 overflow-hidden relative">
                    <div class="absolute inset-0 bg-gradient-to-tr from-indigo-900 via-slate-900 to-emerald-900 opacity-50"></div>
                    <div class="relative glass w-full max-sm:mx-4 max-w-sm p-10 rounded-[40px] shadow-2xl text-center space-y-8 animate-fade-in border-white/10">
                        <img src="${APP_LOGO}" class="w-20 h-20 mx-auto rounded-3xl shadow-xl rotate-3 object-cover" />
                        <div class="space-y-2">
                            <h2 class="text-3xl font-bold text-white tracking-tight">${APP_NAME}</h2>
                            <p class="text-slate-400 text-sm">äº‘ç«¯è°ƒåº¦ å®æ—¶æ§åˆ¶</p>
                        </div>
                        <div class="space-y-4">
                            <input type="password" class="w-full bg-black/40 border ${error ? 'border-red-500' : 'border-white/10'} rounded-2xl px-5 py-4 text-center outline-none focus:ring-2 ring-blue-500 transition-all text-white font-mono" 
                                placeholder="è¾“å…¥è®¿é—®å¯†ç " value=${password} onInput=${e => setPassword(e.target.value)} onKeyDown=${e => e.key === 'Enter' && handleLogin()} />
                            <button onClick=${handleLogin} disabled=${loading} class="w-full bg-blue-600 hover:bg-blue-700 text-white py-4 rounded-2xl font-bold shadow-lg shadow-blue-500/20 active:scale-95 transition-all">
                                ${loading ? 'æ­£åœ¨éªŒè¯...' : 'è¿›å…¥é¢æ¿'}
                            </button>
                            ${error && html`<p class="text-red-500 text-xs font-semibold animate-pulse">å¯†ç æ ¡éªŒå¤±è´¥</p>`}
                        </div>
                    </div>
                </div>
            `;
        };

        // --- å­ç»„ä»¶: DomainManager ---
        const DomainManager = ({ config }) => {
            const [projects, setProjects] = useState([]);
            const [selectedProject, setSelectedProject] = useState('');
            const [domains, setDomains] = useState([]);
            const [newDomain, setNewDomain] = useState('');
            const [loading, setLoading] = useState(false);
            const [logs, setLogs] = useState([]);

            const addLog = (msg) => setLogs(prev => [...prev.slice(-20), `[${new Date().toLocaleTimeString()}] ${msg}`]);

            const fetchData = async (url, options = {}) => {
                const headers = { 
                    'X-Pages-Token': config.pagesToken, 
                    'X-Zone-Token': config.zoneToken, 
                    'X-Account-Id': config.accountId,
                    ...options.headers 
                };
                return fetch(url, { ...options, headers });
            };

            const fetchProjects = async () => {
                if (!config.accountId || !config.pagesToken) {
                    addLog("âš ï¸ è¯·å…ˆåœ¨é…ç½®ä¸­å¿ƒå¡«å†™ API å‡­æ®");
                    return;
                }
                setLoading(true); addLog("æ­£åœ¨è·å– Cloudflare é¡¹ç›®åˆ—è¡¨...");
                try {
                    const resp = await fetchData(`/api/cf/accounts/${config.accountId}/pages/projects`);
                    const data = await resp.json();
                    if (data.success) {
                        setProjects(data.result);
                        if (data.result.length > 0 && !selectedProject) setSelectedProject(data.result[0].name);
                    } else {
                        addLog(`è·å–å¤±è´¥: ${data.errors?.[0]?.message || 'APIå‡­æ®ä¸æ­£ç¡®'}`);
                    }
                } catch (err) { addLog(`ç½‘ç»œé”™è¯¯: ${err}`); } finally { setLoading(false); }
            };

            const fetchDomains = async (projName) => {
                if (!projName) return;
                setLoading(true);
                try {
                    const resp = await fetchData(`/api/cf/accounts/${config.accountId}/pages/projects/${projName}/domains`);
                    const data = await resp.json();
                    if (data.success) setDomains(data.result);
                } catch (err) { addLog(`è·å–åŸŸåå¤±è´¥: ${err}`); } finally { setLoading(false); }
            };

            const handleAction = async (action, domainName = '') => {
                const targetDomain = action === 'add' ? newDomain : domainName;
                if (!targetDomain || !selectedProject) return;
                if (action === 'remove' && !confirm(`ç¡®å®šè¦ç§»é™¤ ${domainName} å—ï¼Ÿ`)) return;
                
                setLoading(true);
                try {
                    const url = `/api/cf/accounts/${config.accountId}/pages/projects/${selectedProject}/domains${domainName ? '/' + domainName : ''}`;
                    const resp = await fetchData(url, {
                        method: action === 'add' ? 'POST' : 'DELETE',
                        body: action === 'add' ? JSON.stringify({ name: targetDomain }) : undefined
                    });
                    const data = await resp.json();
                    if (data.success) {
                        addLog(`âœ… ${action === 'add' ? 'æ·»åŠ ' : 'ç§»é™¤'}æˆåŠŸ: ${targetDomain}`);
                        if (action === 'add') setNewDomain('');
                        fetchDomains(selectedProject);
                    } else { 
                      addLog(`âŒ æ“ä½œå¤±è´¥: ${data.errors?.[0]?.message || 'API é™åˆ¶'}`); 
                    }
                } catch (err) { addLog(`âš ï¸ å¼‚å¸¸: ${err}`); } finally { setLoading(false); }
            };

            useEffect(() => { fetchProjects(); }, [config.accountId, config.pagesToken]);
            useEffect(() => { if (selectedProject) fetchDomains(selectedProject); }, [selectedProject]);

            return html`
                <div class="space-y-6 animate-fade-in">
                    <div class="flex justify-between items-end">
                        <div>
                            <h2 class="text-2xl font-black dark:text-white tracking-tight">åŸŸåæ§åˆ¶</h2>
                            <p class="text-slate-500 text-sm">ç®¡ç† Pages é¡¹ç›®çš„è‡ªå®šä¹‰åŸŸåè§£æ</p>
                        </div>
                        <button onClick=${fetchProjects} class="px-5 py-2.5 bg-white/50 dark:bg-white/10 rounded-xl text-sm hover:bg-white transition-all dark:text-white border border-white/20 font-black shadow-sm">åˆ·æ–°é¡¹ç›®</button>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <div class="p-6 bg-white/40 dark:bg-white/5 rounded-3xl border border-white/20 shadow-sm">
                                <label class="block text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] mb-3">å½“å‰ Pages é¡¹ç›®</label>
                                <select class="w-full bg-white dark:bg-slate-900 border border-slate-200 dark:border-white/10 rounded-2xl px-5 py-4 outline-none dark:text-white text-sm font-bold appearance-none shadow-inner"
                                    value=${selectedProject} onChange=${e => setSelectedProject(e.target.value)}>
                                    ${projects.length === 0 ? html`<option>åŠ è½½ä¸­æˆ–æ— é¡¹ç›®...</option>` : projects.map(p => html`<option value=${p.name}>${p.name}</option>`)}
                                </select>
                            </div>
                            <div class="p-6 bg-white/40 dark:bg-white/5 rounded-3xl border border-white/20 shadow-sm">
                                <label class="block text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] mb-3">ç»‘å®šæ–°å­åŸŸå</label>
                                <div class="flex gap-2">
                                    <input class="flex-1 bg-white dark:bg-slate-900 border border-slate-200 dark:border-white/10 rounded-2xl px-5 py-4 outline-none dark:text-white text-sm font-mono shadow-inner" 
                                        placeholder="ä¾‹å¦‚: v2.domain.com" value=${newDomain} onInput=${e => setNewDomain(e.target.value)} />
                                    <button onClick=${() => handleAction('add')} disabled=${loading || !newDomain} class="bg-blue-600 text-white px-8 rounded-2xl font-black hover:bg-blue-700 disabled:opacity-50 transition-all shadow-lg shadow-blue-500/20">æ·»åŠ </button>
                                </div>
                            </div>
                        </div>

                        <div class="p-6 bg-white/40 dark:bg-white/5 rounded-3xl border border-white/20 flex flex-col min-h-[250px] shadow-sm">
                            <label class="block text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] mb-4">å·²ç»‘å®šçš„è‡ªå®šä¹‰åŸŸå</label>
                            <div class="flex-1 overflow-y-auto space-y-3 pr-2 custom-scroll">
                                ${domains.length === 0 ? html`<div class="h-full flex items-center justify-center opacity-30 italic text-sm dark:text-white">æœªæ‰¾åˆ°è‡ªå®šä¹‰åŸŸå</div>` : 
                                  domains.map(d => html`
                                    <div class="flex items-center justify-between p-4 bg-white/80 dark:bg-slate-900/50 rounded-2xl border border-slate-100 dark:border-white/5 shadow-sm">
                                      <div>
                                        <div class="text-sm dark:text-white font-black font-mono tracking-tight">${d.name}</div>
                                        <div class="text-[9px] mt-1 ${d.status === 'active' ? 'text-emerald-500' : 'text-orange-400'} uppercase font-black tracking-widest flex items-center gap-1">
                                            <span class="w-1.5 h-1.5 rounded-full ${d.status === 'active' ? 'bg-emerald-500' : 'bg-orange-400 animate-pulse'}"></span>
                                            ${d.status}
                                        </div>
                                      </div>
                                      <button onClick=${() => handleAction('remove', d.name)} class="text-red-500 text-[10px] hover:bg-red-50 dark:hover:bg-red-900/20 px-4 py-2 rounded-xl font-black uppercase transition-colors">ç§»é™¤</button>
                                    </div>
                                `)}
                            </div>
                        </div>
                    </div>

                    <div class="bg-slate-900 text-emerald-400 p-5 rounded-3xl font-mono text-[10px] h-36 overflow-y-auto border border-white/5 shadow-inner custom-scroll leading-relaxed">
                        ${logs.map(log => html`<div class="mb-1">${log}</div>`)}
                        ${logs.length === 0 && html`<div class="opacity-20 italic">ç­‰å¾…æ“ä½œåé¦ˆ...</div>`}
                    </div>
                </div>
            `;
        };

        // --- å­ç»„ä»¶: SubdomainGenerator ---
        const SubdomainGenerator = ({ config }) => {
            const [dateStr, setDateStr] = useState('');
            const [results, setResults] = useState([]);

            const handleGenerate = () => {
                const parts = dateStr.trim().split(".");
                if (parts.length !== 2) { alert("âš ï¸ è¯·ä½¿ç”¨ MM.DD æ ¼å¼ (ä¾‹å¦‚ 05.20)"); return; }
                const randomL = (n) => Array.from({length:n}, () => "abcdefghijklmnopqrstuvwxyz"[Math.floor(Math.random()*26)]).join('');
                
                const month = parts[0].padStart(2, '0');
                const day = parts[1].padStart(2, '0');
                
                const prefix = randomL(2) + month + randomL(2) + day + randomL(2);
                const parent = config.parentDomain || 'hyeri.top';
                const domain = `${prefix}.${parent}`;
                
                const res = [{ label: 'éšæœºå­åŸŸå', value: domain }];
                
                // è‡ªåŠ¨åŒæ­¥â€œé…ç½®ä¸­å¿ƒâ€ä¸­ç®¡ç†çš„æ‰€æœ‰ U è·¯å¾„
                (config.paths || []).forEach(p => {
                    const pathVal = p.value.trim() || p.label;
                    res.push({ label: `è®¢é˜…é“¾æ¥ (${p.label})`, value: `https://${domain}/${pathVal}` });
                });
                setResults(res);
            };

            return html`
                <div class="max-w-xl mx-auto py-4 space-y-8 animate-fade-in">
                    <div class="text-center space-y-3">
                        <h2 class="text-4xl font-black dark:text-white tracking-tight">è°ƒåº¦ä¸­å¿ƒ</h2>
                        <p class="text-slate-500 font-medium italic">åŸºäºæ—¥æœŸç®—æ³•åŠ¨æ€ç”Ÿæˆåˆ†å‘åœ°å€</p>
                    </div>
                    <div class="bg-white/40 dark:bg-white/5 p-10 rounded-[50px] border border-white/20 shadow-2xl space-y-8">
                        <div class="space-y-4">
                            <label class="block text-xs font-black text-slate-400 uppercase tracking-widest pl-2">å½“å‰åˆ†å‘ç¯å¢ƒ: <span class="text-blue-600 dark:text-blue-400">${config.parentDomain || 'æœªè®¾ç½®'}</span></label>
                            <div class="flex gap-4">
                                <input class="flex-1 bg-white dark:bg-slate-900 border border-slate-200 dark:border-white/10 rounded-[24px] px-8 py-5 outline-none text-2xl font-mono dark:text-white shadow-inner focus:ring-4 ring-blue-500/10 transition-all" 
                                    placeholder="08.15" value=${dateStr} onInput=${e => setDateStr(e.target.value)} onKeyDown=${e => e.key === 'Enter' && handleGenerate()} />
                                <button onClick=${handleGenerate} class="bg-blue-600 text-white px-10 rounded-[24px] font-black text-lg shadow-xl shadow-blue-500/30 hover:bg-blue-700 transition-all active:scale-95">ç”Ÿæˆ</button>
                            </div>
                        </div>
                        ${results.length > 0 && html`
                            <div class="space-y-4 pt-6 border-t border-slate-100 dark:border-white/10 animate-fade-in">
                                ${results.map(r => html`
                                    <div class="p-6 bg-white/80 dark:bg-black/40 border border-slate-100 dark:border-white/5 rounded-[32px] flex items-center justify-between group hover:border-blue-500/50 transition-all shadow-sm">
                                        <div class="overflow-hidden pr-4">
                                            <div class="text-[9px] font-black text-slate-400 dark:text-slate-500 uppercase tracking-widest mb-1">${r.label}</div>
                                            <div class="text-base font-mono truncate dark:text-slate-200 font-bold">${r.value}</div>
                                        </div>
                                        <button onClick=${() => {navigator.clipboard.writeText(r.value); alert('ğŸ“‹ å·²å¤åˆ¶')}} class="flex-shrink-0 p-4 bg-slate-50 dark:bg-slate-800 rounded-2xl text-[10px] font-black text-blue-600 dark:text-blue-400 uppercase hover:bg-blue-600 hover:text-white transition-all shadow-inner">å¤åˆ¶</button>
                                    </div>
                                `)}
                            </div>
                        `}
                    </div>
                </div>
            `;
        };

        // --- å­ç»„ä»¶: Settings ---
        const Settings = ({ config, setConfig }) => {
            const [local, setLocal] = useState({ ...config });
            const [saving, setSaving] = useState(false);

            const handleSave = async () => {
                setSaving(true);
                try {
                    const resp = await fetch('/api/config', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(local)
                    });
                    if ((await resp.json()).success) { 
                        setConfig(local); 
                        alert("âœ… è®¾ç½®å·²ä¿å­˜è‡³äº‘ç«¯ KV æ•°æ®åº“"); 
                    }
                } catch (e) { alert("âŒ ç½‘ç»œé”™è¯¯: " + e); } finally { setSaving(false); }
            };

            const addPath = () => {
                const nextId = (local.paths || []).length + 1;
                setLocal({ ...local, paths: [...(local.paths || []), { label: 'U' + nextId, value: '' }] });
            };

            const removePath = (idx) => {
                setLocal({ ...local, paths: local.paths.filter((_, i) => i !== idx) });
            };

            const updatePath = (idx, field, val) => {
                const p = [...local.paths]; p[idx][field] = val; setLocal({...local, paths: p});
            };

            return html`
                <div class="space-y-8 pb-10 animate-fade-in">
                    <div class="flex justify-between items-center">
                        <div>
                            <h2 class="text-2xl font-black dark:text-white tracking-tight">é…ç½®ä¸­å¿ƒ</h2>
                            <p class="text-slate-500 text-sm font-medium">é…ç½® API å‡­è¯åŠè‡ªå®šä¹‰è·¯å¾„åˆ†å‘æ¨¡æ¿</p>
                        </div>
                        <button onClick=${handleSave} disabled=${saving} class="bg-blue-600 text-white px-10 py-3.5 rounded-2xl font-black shadow-xl shadow-blue-500/20 hover:bg-blue-700 transition-all active:scale-95">
                          ${saving ? 'æ­£åœ¨åŒæ­¥...' : 'ä¿å­˜ä¿®æ”¹'}
                        </button>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div class="space-y-4">
                          <h3 class="text-xs font-black text-slate-400 uppercase tracking-widest flex items-center gap-2 px-2">ğŸ”‘ Cloudflare API å‡­æ®</h3>
                          <div class="p-8 bg-white/40 dark:bg-white/5 rounded-[40px] border border-white/20 space-y-6 shadow-sm">
                              <div class="space-y-2">
                                  <label class="text-[10px] font-black text-blue-600 dark:text-blue-400 uppercase tracking-widest ml-1">1. è´¦æˆ· ID (Account ID)</label>
                                  <input class="w-full bg-white dark:bg-slate-900 border border-slate-200 dark:border-white/10 rounded-2xl px-6 py-4 dark:text-white text-sm font-mono shadow-inner outline-none focus:ring-2 ring-blue-500/30 transition-all" 
                                      placeholder="Account ID" value=${local.accountId} onInput=${e => setLocal({...local, accountId: e.target.value})} />
                              </div>
                              <div class="space-y-2">
                                  <label class="text-[10px] font-black text-emerald-600 dark:text-emerald-400 uppercase tracking-widest ml-1">2. Pages ä»¤ç‰Œ (Pages API Token)</label>
                                  <input type="password" class="w-full bg-white dark:bg-slate-900 border border-slate-200 dark:border-white/10 rounded-2xl px-6 py-4 dark:text-white text-sm font-mono shadow-inner outline-none focus:ring-2 ring-emerald-500/30 transition-all" 
                                      placeholder="Pages Edit Token" value=${local.pagesToken} onInput=${e => setLocal({...local, pagesToken: e.target.value})} />
                              </div>
                              <div class="space-y-2">
                                  <label class="text-[10px] font-black text-orange-600 dark:text-orange-400 uppercase tracking-widest ml-1">3. DNS ä»¤ç‰Œ (Zone API Token)</label>
                                  <input type="password" class="w-full bg-white dark:bg-slate-900 border border-slate-200 dark:border-white/10 rounded-2xl px-6 py-4 dark:text-white text-sm font-mono shadow-inner outline-none focus:ring-2 ring-orange-500/30 transition-all" 
                                      placeholder="DNS Edit Token" value=${local.zoneToken} onInput=${e => setLocal({...local, zoneToken: e.target.value})} />
                              </div>
                          </div>
                        </div>

                        <div class="space-y-4">
                          <h3 class="text-xs font-black text-slate-400 uppercase tracking-widest flex items-center gap-2 px-2">ğŸ¨ ç•Œé¢ä¸è§£æè®¾ç½®</h3>
                          <div class="p-8 bg-white/40 dark:bg-white/5 rounded-[40px] border border-white/20 space-y-6 shadow-sm">
                              <div class="space-y-2">
                                  <label class="text-[10px] font-black text-slate-500 uppercase tracking-widest ml-1">åˆ†å‘æ ¹åŸŸå (Parent Domain)</label>
                                  <input class="w-full bg-white dark:bg-slate-900 border border-slate-200 dark:border-white/10 rounded-2xl px-6 py-4 dark:text-white text-sm font-mono shadow-inner outline-none focus:ring-2 ring-purple-500/30 transition-all" 
                                      placeholder="ä¾‹å¦‚: hyeri.us.kg" value=${local.parentDomain} onInput=${e => setLocal({...local, parentDomain: e.target.value})} />
                              </div>
                              <div class="space-y-2">
                                  <label class="text-[10px] font-black text-slate-500 uppercase tracking-widest ml-1">èƒŒæ™¯èƒŒæ™¯ç›´é“¾ (æ”¯æŒè§†é¢‘)</label>
                                  <input class="w-full bg-white dark:bg-slate-900 border border-slate-200 dark:border-white/10 rounded-2xl px-6 py-4 dark:text-white text-sm font-mono shadow-inner outline-none focus:ring-2 ring-purple-500/30 transition-all" 
                                      placeholder="https://.../video.mp4" value=${local.backgroundUrl} onInput=${e => setLocal({...local, backgroundUrl: e.target.value})} />
                              </div>
                          </div>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <div class="flex items-center justify-between px-2">
                             <h3 class="text-xs font-black text-slate-400 uppercase tracking-widest flex items-center gap-2">ğŸ”— è·¯å¾„æ¨¡æ¿ç®¡ç† (U1, U2...)</h3>
                             <button onClick=${addPath} class="text-[11px] font-black bg-blue-100 dark:bg-blue-900/40 text-blue-600 dark:text-blue-400 px-6 py-3 rounded-2xl shadow-sm hover:scale-105 transition-all">+ æ–°å¢ U æ§½ä½</button>
                        </div>
                        <div class="bg-white/40 dark:bg-white/5 rounded-[40px] border border-white/20 overflow-hidden shadow-sm">
                             <table class="w-full text-left text-sm border-collapse">
                                <thead class="bg-slate-50 dark:bg-white/5 border-b border-slate-200 dark:border-white/10">
                                    <tr>
                                        <th class="px-8 py-5 font-black text-slate-500 uppercase text-[10px] tracking-widest">æ§½ä½æ ‡ç­¾</th>
                                        <th class="px-8 py-5 font-black text-slate-500 uppercase text-[10px] tracking-widest">è·¯å¾„åç¼€ (Path)</th>
                                        <th class="px-8 py-5"></th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-slate-100 dark:divide-white/5">
                                    ${(local.paths || []).map((p, i) => html`
                                        <tr class="hover:bg-white/60 dark:hover:bg-white/10 transition-colors">
                                            <td class="px-8 py-5 font-black text-blue-600 dark:text-blue-400">
                                                <input class="bg-transparent outline-none w-full" value=${p.label} onInput=${e => updatePath(i, 'label', e.target.value)} />
                                            </td>
                                            <td class="px-8 py-5 font-mono text-slate-600 dark:text-slate-300">
                                                <input class="bg-transparent outline-none w-full placeholder:opacity-30" placeholder="ä¾‹å¦‚: vless-config" value=${p.value} onInput=${e => updatePath(i, 'value', e.target.value)} />
                                            </td>
                                            <td class="px-8 py-5 text-right">
                                                <button onClick=${() => removePath(i)} class="text-red-400 hover:text-red-600 font-black text-[10px] uppercase transition-colors">åˆ é™¤</button>
                                            </td>
                                        </tr>
                                    `)}
                                    ${(!local.paths || local.paths.length === 0) && html`<tr><td colspan="3" class="px-8 py-16 text-center text-slate-400 italic font-medium">å°šæœªå®šä¹‰ä»»ä½• U1/U2 è·¯å¾„æ¨¡ç‰ˆ</td></tr>`}
                                </tbody>
                             </table>
                        </div>
                    </div>
                </div>
            `;
        };

        // --- ä¸»ç¨‹åº: App ---
        const App = () => {
            const [auth, setAuth] = useState(sessionStorage.getItem('authenticated') === 'true');
            const [tab, setTab] = useState('domains');
            const [isDark, setIsDark] = useState(false);
            const [config, setConfig] = useState({ 
                accountId: '', 
                pagesToken: '', 
                zoneToken: '', 
                backgroundUrl: '', 
                parentDomain: '', 
                paths: [{label:'U1', value:''}] 
            });

            useEffect(() => {
                if (auth) { fetch('/api/config').then(r => r.json()).then(d => d.success && d.config && setConfig(d.config)); }
            }, [auth]);

            useEffect(() => {
                document.documentElement.classList.toggle('dark', isDark);
                const bg = document.getElementById('custom-bg-layer'); if (bg) bg.remove();
                if (config.backgroundUrl) {
                    const isVid = /\.(mp4|webm|mov)(\?|$)/i.test(config.backgroundUrl);
                    const el = document.createElement(isVid ? 'video' : 'img');
                    el.id = 'custom-bg-layer'; el.src = config.backgroundUrl;
                    el.style.opacity = '0';
                    if (isVid) { el.autoplay = el.loop = el.muted = el.playsInline = true; }
                    document.body.appendChild(el); setTimeout(() => el.style.opacity = '1', 50);
                }
            }, [isDark, config.backgroundUrl]);

            if (!auth) return html`<${Login} onLoginSuccess=${() => setAuth(true)} />`;

            return html`
                <div class="flex h-screen w-screen overflow-hidden relative z-10 p-4 max-md:p-3 max-md:flex-col">
                    
                    <!-- Mobile Top Bar (ä»…ç§»åŠ¨ç«¯æ˜¾ç¤º) -->
                    <div class="md:hidden flex items-center justify-between mb-3 px-2">
                        <div class="flex items-center gap-3">
                            <img src="${APP_LOGO}" class="w-9 h-9 rounded-2xl shadow-lg object-cover" />
                            <h1 class="font-black text-base dark:text-white tracking-tight">${APP_NAME}</h1>
                        </div>
                        <button onClick=${() => setIsDark(!isDark)} class="p-3 rounded-2xl glass text-lg shadow-sm">
                            ${isDark ? 'ğŸŒ™' : 'â˜€ï¸'}
                        </button>
                    </div>

                    <!-- Desktop Sidebar (ç§»åŠ¨ç«¯éšè—) -->
                    <div class="w-64 max-md:hidden glass rounded-[36px] p-6 flex flex-col shadow-2xl mr-4 border-white/20">
                        <div class="flex items-center gap-4 mb-12 pl-2">
                            <img src="${APP_LOGO}" class="w-12 h-12 rounded-2xl shadow-xl object-cover" />
                            <h1 class="font-black text-xl dark:text-white tracking-tighter">${APP_NAME}</h1>
                        </div>
                        <nav class="flex-1 space-y-3">
                            ${[
                              {id: 'domains', label: 'åŸŸåæ§åˆ¶', icon: 'ğŸŒ'},
                              {id: 'generator', label: 'éšæœºç”Ÿæˆ', icon: 'âœ¨'},
                              {id: 'settings', label: 'é…ç½®ä¸­å¿ƒ', icon: 'âš™ï¸'}
                            ].map(t => html`
                                <button onClick=${() => setTab(t.id)} class="w-full flex items-center gap-4 px-6 py-4 rounded-2xl transition-all duration-300 ${tab === t.id ? 'bg-blue-600 text-white shadow-xl scale-[1.03]' : 'text-slate-500 dark:text-slate-400 hover:bg-white/60 dark:hover:bg-white/10'}">
                                    <span class="text-xl">${t.icon}</span>
                                    <span class="font-black text-sm uppercase tracking-[0.1em]">${t.label}</span>
                                </button>
                            `)}
                        </nav>
                        <div class="flex items-center justify-between pt-6 border-t border-slate-200 dark:border-white/10">
                          <button onClick=${() => setIsDark(!isDark)} class="p-4 rounded-2xl bg-slate-100 dark:bg-slate-800 text-xl hover:scale-110 active:scale-95 transition-transform">
                              ${isDark ? 'ğŸŒ™' : 'â˜€ï¸'}
                          </button>
                          <span class="text-[9px] font-black text-slate-400 uppercase tracking-[0.3em] opacity-60">Stable v2.6</span>
                        </div>
                    </div>

                    <!-- Main Content Panel -->
                    <main class="flex-1 overflow-y-auto p-10 max-md:p-6 max-md:pb-28 glass rounded-[36px] shadow-2xl relative border-white/20 custom-scroll">
                        ${tab === 'domains' && html`<${DomainManager} config=${config} />`}
                        ${tab === 'generator' && html`<${SubdomainGenerator} config=${config} />`}
                        ${tab === 'settings' && html`<${Settings} config=${config} setConfig=${setConfig} />`}
                    </main>

                    <!-- Mobile Bottom Tab Bar (ä»…ç§»åŠ¨ç«¯æ˜¾ç¤º) -->
                    <div class="md:hidden fixed bottom-6 left-6 right-6 z-50 glass rounded-[28px] p-2 flex justify-around shadow-2xl border-white/20">
                        ${[
                          {id: 'domains', label: 'åŸŸå', icon: 'ğŸŒ'},
                          {id: 'generator', label: 'ç”Ÿæˆ', icon: 'âœ¨'},
                          {id: 'settings', label: 'é…ç½®', icon: 'âš™ï¸'}
                        ].map(t => html`
                            <button onClick=${() => setTab(t.id)} class="flex flex-col items-center justify-center gap-1 w-full py-3 transition-all ${tab === t.id ? 'mobile-nav-active' : 'text-slate-400 opacity-60'}">
                                <span class="text-xl">${t.icon}</span>
                                <span class="text-[9px] font-black uppercase tracking-widest">${t.label}</span>
                            </button>
                        `)}
                    </div>

                    <!-- Background Fallback -->
                    ${!config.backgroundUrl && html`<div class="fixed inset-0 -z-20 bg-gradient-to-br from-indigo-100 via-white to-sky-100 dark:from-slate-950 dark:via-slate-900 dark:to-slate-950"></div>`}
                </div>
            `;
        };

        render(html`<${App} />`, document.getElementById('root'));
    </script>
</body>
</html>
