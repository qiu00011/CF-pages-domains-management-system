
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­æ€¡vpné¢æ¿ - ç»¼åˆç®¡ç†ç³»ç»Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; margin: 0; overflow: hidden; }
        .glass {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        .dark .glass {
            background: rgba(30, 30, 30, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        #custom-bg-layer {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -10;
            object-fit: cover;
            transition: opacity 1.5s ease;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.5s ease forwards; }
        .custom-scroll::-webkit-scrollbar { width: 4px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.1); border-radius: 10px; }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
</head>
<body class="bg-slate-50 text-slate-900 transition-colors duration-500">
    <div id="root"></div>

    <script type="module">
        import { h, Component, render } from 'https://esm.sh/preact';
        import { useState, useEffect, useCallback, useMemo } from 'https://esm.sh/preact/hooks';
        import htm from 'https://esm.sh/htm';

        const html = htm.bind(h);

        const APP_LOGO = "https://image.hyeri.us.kg/icon.png";
        const APP_NAME = "å­æ€¡vpné¢æ¿";

        // --- å­ç»„ä»¶: Login ---
        const Login = ({ onLoginSuccess }) => {
            const [password, setPassword] = useState('');
            const [error, setError] = useState(false);
            const [loading, setLoading] = useState(false);

            const handleLogin = async () => {
                setLoading(true); setError(false);
                try {
                    const resp = await fetch('/api/auth', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ password })
                    });
                    const data = await resp.json();
                    if (data.success) {
                        sessionStorage.setItem('authenticated', 'true');
                        onLoginSuccess();
                    } else { setError(true); }
                } catch (e) { setError(true); } finally { setLoading(false); }
            };

            return html`
                <div class="h-screen w-screen flex items-center justify-center bg-slate-900 overflow-hidden relative">
                    <div class="absolute inset-0 bg-gradient-to-tr from-indigo-900 via-slate-900 to-emerald-900 opacity-50"></div>
                    <div class="relative glass w-full max-sm:mx-4 max-w-sm p-10 rounded-[40px] shadow-2xl text-center space-y-8 animate-fade-in border-white/10">
                        <img src="${APP_LOGO}" class="w-20 h-20 mx-auto rounded-3xl shadow-xl rotate-3 object-cover" />
                        <div class="space-y-2">
                            <h2 class="text-3xl font-bold text-white">${APP_NAME}</h2>
                            <p class="text-slate-400 text-sm">äº‘ç«¯ Pages è°ƒåº¦ç³»ç»Ÿ</p>
                        </div>
                        <div class="space-y-4">
                            <input type="password" class="w-full bg-black/40 border ${error ? 'border-red-500' : 'border-white/10'} rounded-2xl px-5 py-4 text-center outline-none focus:ring-2 ring-blue-500 transition-all text-white font-mono" 
                                placeholder="è¾“å…¥è®¿é—®å¯†ç " value=${password} onInput=${e => setPassword(e.target.value)} onKeyDown=${e => e.key === 'Enter' && handleLogin()} />
                            <button onClick=${handleLogin} disabled=${loading} class="w-full bg-blue-600 hover:bg-blue-700 text-white py-4 rounded-2xl font-bold shadow-lg shadow-blue-500/20 active:scale-95 transition-all">
                                ${loading ? 'æ­£åœ¨è¿›å…¥...' : 'ç«‹å³è¿›å…¥ç³»ç»Ÿ'}
                            </button>
                            ${error && html`<p class="text-red-500 text-xs font-semibold animate-pulse">éªŒè¯å¤±è´¥</p>`}
                        </div>
                    </div>
                </div>
            `;
        };

        // --- å­ç»„ä»¶: DomainManager ---
        const DomainManager = ({ config }) => {
            const [projects, setProjects] = useState([]);
            const [selectedProject, setSelectedProject] = useState('');
            const [domains, setDomains] = useState([]);
            const [newDomain, setNewDomain] = useState('');
            const [loading, setLoading] = useState(false);
            const [logs, setLogs] = useState([]);

            const addLog = (msg) => setLogs(prev => [...prev.slice(-20), `[${new Date().toLocaleTimeString()}] ${msg}`]);

            const fetchData = async (url, options = {}) => {
                const headers = { 
                    'X-Pages-Token': config.pagesToken, 
                    'X-Zone-Token': config.zoneToken, 
                    'X-Account-Id': config.accountId,
                    ...options.headers 
                };
                return fetch(url, { ...options, headers });
            };

            const fetchProjects = async () => {
                if (!config.accountId || !config.pagesToken) {
                    addLog("âš ï¸ è¯·å…ˆåœ¨é…ç½®ä¸­å¿ƒå¡«å†™ API å‡­æ®");
                    return;
                }
                setLoading(true); addLog("æ­£åœ¨è·å– Cloudflare é¡¹ç›®åˆ—è¡¨...");
                try {
                    const resp = await fetchData(`/api/cf/accounts/${config.accountId}/pages/projects`);
                    const data = await resp.json();
                    if (data.success) {
                        setProjects(data.result);
                        if (data.result.length > 0 && !selectedProject) setSelectedProject(data.result[0].name);
                    } else {
                        addLog(`è·å–å¤±è´¥: ${data.errors?.[0]?.message || 'æœªçŸ¥é”™è¯¯'}`);
                    }
                } catch (err) { addLog(`ç½‘ç»œé”™è¯¯: ${err}`); } finally { setLoading(false); }
            };

            const fetchDomains = async (projName) => {
                if (!projName) return;
                setLoading(true);
                try {
                    const resp = await fetchData(`/api/cf/accounts/${config.accountId}/pages/projects/${projName}/domains`);
                    const data = await resp.json();
                    if (data.success) setDomains(data.result);
                } catch (err) { addLog(`è·å–åŸŸåå¤±è´¥: ${err}`); } finally { setLoading(false); }
            };

            const handleAction = async (action, domainName = '') => {
                const targetDomain = action === 'add' ? newDomain : domainName;
                if (!targetDomain || !selectedProject) return;
                if (action === 'remove' && !confirm(`ç¡®å®šè¦ç§»é™¤ ${domainName} å—ï¼Ÿ`)) return;
                
                setLoading(true);
                try {
                    const url = `/api/cf/accounts/${config.accountId}/pages/projects/${selectedProject}/domains${domainName ? '/' + domainName : ''}`;
                    const resp = await fetchData(url, {
                        method: action === 'add' ? 'POST' : 'DELETE',
                        body: action === 'add' ? JSON.stringify({ name: targetDomain }) : undefined
                    });
                    const data = await resp.json();
                    if (data.success) {
                        addLog(`âœ… æ“ä½œæˆåŠŸ: ${targetDomain}`);
                        if (action === 'add') setNewDomain('');
                        fetchDomains(selectedProject);
                    } else { 
                      addLog(`âŒ æ“ä½œå¤±è´¥: ${data.errors?.[0]?.message || 'API é”™è¯¯'}`); 
                    }
                } catch (err) { addLog(`âš ï¸ å¼‚å¸¸: ${err}`); } finally { setLoading(false); }
            };

            useEffect(() => { fetchProjects(); }, [config.accountId, config.pagesToken]);
            useEffect(() => { if (selectedProject) fetchDomains(selectedProject); }, [selectedProject]);

            return html`
                <div class="space-y-6 animate-fade-in">
                    <div class="flex justify-between items-end">
                        <div>
                            <h2 class="text-2xl font-bold dark:text-white tracking-tight">åŸŸåæ§åˆ¶</h2>
                            <p class="text-slate-500 text-sm">ç»‘å®šä¸ç®¡ç† Pages è‡ªå®šä¹‰åŸŸå</p>
                        </div>
                        <button onClick=${fetchProjects} class="px-4 py-2 bg-white/50 dark:bg-white/10 rounded-lg text-sm hover:bg-white transition-colors dark:text-white border border-white/20 font-bold">åˆ·æ–°</button>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <div class="p-5 bg-white/40 dark:bg-white/5 rounded-2xl border border-white/20">
                                <label class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2">é€‰æ‹© Pages é¡¹ç›®</label>
                                <select class="w-full bg-white dark:bg-slate-900 border border-slate-200 dark:border-white/10 rounded-xl px-4 py-3 outline-none dark:text-white text-sm"
                                    value=${selectedProject} onChange=${e => setSelectedProject(e.target.value)}>
                                    ${projects.length === 0 ? html`<option>æš‚æ— é¡¹ç›®</option>` : projects.map(p => html`<option value=${p.name}>${p.name}</option>`)}
                                </select>
                            </div>
                            <div class="p-5 bg-white/40 dark:bg-white/5 rounded-2xl border border-white/20">
                                <label class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2">å¿«é€Ÿç»‘å®šåŸŸå</label>
                                <div class="flex gap-2">
                                    <input class="flex-1 bg-white dark:bg-slate-900 border border-slate-200 dark:border-white/10 rounded-xl px-4 py-3 outline-none dark:text-white text-sm font-mono" 
                                        placeholder="sub.yourdomain.com" value=${newDomain} onInput=${e => setNewDomain(e.target.value)} />
                                    <button onClick=${() => handleAction('add')} disabled=${loading || !newDomain} class="bg-blue-600 text-white px-6 rounded-xl font-bold hover:bg-blue-700 disabled:opacity-50 transition-all">æ·»åŠ </button>
                                </div>
                            </div>
                        </div>

                        <div class="p-5 bg-white/40 dark:bg-white/5 rounded-2xl border border-white/20 flex flex-col min-h-[220px]">
                            <label class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-3">å½“å‰å·²ç»‘å®šåŸŸå</label>
                            <div class="flex-1 overflow-y-auto space-y-2 pr-2 custom-scroll">
                                ${domains.length === 0 ? html`<div class="h-full flex items-center justify-center opacity-30 italic text-sm dark:text-white">æš‚æ— åŸŸå</div>` : 
                                  domains.map(d => html`
                                    <div class="flex items-center justify-between p-3 bg-white dark:bg-slate-900/50 rounded-xl border border-slate-100 dark:border-white/5">
                                      <div>
                                        <div class="text-sm dark:text-white font-bold font-mono">${d.name}</div>
                                        <div class="text-[9px] ${d.status === 'active' ? 'text-emerald-500' : 'text-orange-400'} uppercase font-black tracking-tighter">${d.status}</div>
                                      </div>
                                      <button onClick=${() => handleAction('remove', d.name)} class="text-red-500 text-[10px] hover:bg-red-50 dark:hover:bg-red-900/20 px-3 py-2 rounded-lg font-black uppercase">ç§»é™¤</button>
                                    </div>
                                `)}
                            </div>
                        </div>
                    </div>

                    <div class="bg-slate-900 text-emerald-400 p-4 rounded-2xl font-mono text-[10px] h-32 overflow-y-auto border border-white/5 shadow-inner custom-scroll">
                        ${logs.map(log => html`<div>${log}</div>`)}
                        ${logs.length === 0 && html`<div class="opacity-20 italic">ç­‰å¾…æ“ä½œæ—¥å¿—...</div>`}
                    </div>
                </div>
            `;
        };

        // --- å­ç»„ä»¶: SubdomainGenerator ---
        const SubdomainGenerator = ({ config }) => {
            const [dateStr, setDateStr] = useState('');
            const [results, setResults] = useState([]);

            const handleGenerate = () => {
                const parts = dateStr.split(".");
                if (parts.length !== 2) { alert("âš ï¸ æ ¼å¼é”™è¯¯ï¼Œè¯·ä½¿ç”¨ MM.DD (å¦‚ 05.20)"); return; }
                const randomL = (n) => Array.from({length:n}, () => "abcdefghijklmnopqrstuvwxyz"[Math.floor(Math.random()*26)]).join('');
                
                const month = parts[0].padStart(2, '0');
                const day = parts[1].padStart(2, '0');
                
                // é€»è¾‘: éšæœº2ä½ + MM + éšæœº2ä½ + DD + éšæœº2ä½
                const prefix = randomL(2) + month + randomL(2) + day + randomL(2);
                const parent = config.parentDomain || 'example.com';
                const domain = `${prefix}.${parent}`;
                
                const res = [{ label: 'å­åŸŸå', value: domain }];
                
                // åŒæ­¥è¯»å–é…ç½®ä¸­å¿ƒçš„ U è·¯å¾„
                (config.paths || []).forEach(p => {
                    const pathVal = p.value.trim() || p.label;
                    res.push({ label: `è®¢é˜…é“¾æ¥ (${p.label})`, value: `https://${domain}/${pathVal}` });
                });
                setResults(res);
            };

            return html`
                <div class="max-w-xl mx-auto py-4 space-y-8 animate-fade-in">
                    <div class="text-center space-y-2">
                        <h2 class="text-4xl font-black dark:text-white tracking-tight">éšæœºç”Ÿæˆ</h2>
                        <p class="text-slate-500 font-medium italic">åŸºäºæ—¥æœŸé€»è¾‘ç”Ÿæˆå”¯ä¸€è®¿é—®åœ°å€</p>
                    </div>
                    <div class="bg-white/40 dark:bg-white/5 p-10 rounded-[40px] border border-white/20 shadow-2xl space-y-8">
                        <div class="space-y-4">
                            <label class="block text-xs font-black text-slate-400 uppercase tracking-widest pl-2">è¾“å…¥æ—¥æœŸ (MM.DD)</label>
                            <div class="flex gap-4">
                                <input class="flex-1 bg-white dark:bg-slate-900 border border-slate-200 dark:border-white/10 rounded-2xl px-6 py-5 outline-none text-2xl font-mono dark:text-white shadow-inner" 
                                    placeholder="05.20" value=${dateStr} onInput=${e => setDateStr(e.target.value)} onKeyDown=${e => e.key === 'Enter' && handleGenerate()} />
                                <button onClick=${handleGenerate} class="bg-blue-600 text-white px-10 rounded-2xl font-black text-lg shadow-xl shadow-blue-500/30 hover:bg-blue-700 transition-all active:scale-95">ç”Ÿæˆ</button>
                            </div>
                        </div>
                        ${results.length > 0 && html`
                            <div class="space-y-3 pt-6 border-t border-slate-100 dark:border-white/10">
                                ${results.map(r => html`
                                    <div class="p-5 bg-white dark:bg-slate-900 border border-slate-100 dark:border-white/5 rounded-3xl flex items-center justify-between group hover:border-blue-500/50 transition-colors shadow-sm">
                                        <div class="overflow-hidden pr-4">
                                            <div class="text-[9px] font-black text-slate-400 uppercase tracking-widest mb-1">${r.label}</div>
                                            <div class="text-sm font-mono truncate dark:text-slate-200 font-bold">${r.value}</div>
                                        </div>
                                        <button onClick=${() => {navigator.clipboard.writeText(r.value); alert('ğŸ“‹ å¤åˆ¶æˆåŠŸ')}} class="p-3 bg-slate-50 dark:bg-slate-800 rounded-xl text-[10px] font-black text-blue-600 dark:text-blue-400 uppercase hover:bg-blue-600 hover:text-white transition-all shadow-inner">å¤åˆ¶</button>
                                    </div>
                                `)}
                            </div>
                        `}
                    </div>
                </div>
            `;
        };

        // --- å­ç»„ä»¶: Settings ---
        const Settings = ({ config, setConfig }) => {
            const [local, setLocal] = useState({ ...config });
            const [saving, setSaving] = useState(false);

            const handleSave = async () => {
                setSaving(true);
                try {
                    const resp = await fetch('/api/config', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(local)
                    });
                    if ((await resp.json()).success) { 
                        setConfig(local); 
                        alert("âœ… é…ç½®ä¿å­˜æˆåŠŸï¼Œç³»ç»Ÿå·²åŒæ­¥"); 
                    }
                } catch (e) { alert("âŒ ä¿å­˜å¤±è´¥: " + e); } finally { setSaving(false); }
            };

            const addPath = () => {
                const nextId = (local.paths || []).length + 1;
                setLocal({ ...local, paths: [...(local.paths || []), { label: 'U' + nextId, value: '' }] });
            };

            const removePath = (idx) => {
                setLocal({ ...local, paths: local.paths.filter((_, i) => i !== idx) });
            };

            const updatePath = (idx, field, val) => {
                const p = [...local.paths]; p[idx][field] = val; setLocal({...local, paths: p});
            };

            return html`
                <div class="space-y-8 pb-10 animate-fade-in">
                    <div class="flex justify-between items-center">
                        <div>
                            <h2 class="text-2xl font-black dark:text-white tracking-tight">é…ç½®ä¸­å¿ƒ</h2>
                            <p class="text-slate-500 text-sm font-medium">è®¾ç½® API å‡­è¯ä¸åˆ†å‘è·¯å¾„é€»è¾‘</p>
                        </div>
                        <button onClick=${handleSave} disabled=${saving} class="bg-blue-600 text-white px-10 py-3.5 rounded-2xl font-black shadow-xl shadow-blue-500/20 hover:bg-blue-700 transition-all">
                          ${saving ? 'æ­£åœ¨ä¿å­˜...' : 'ä¿å­˜é…ç½®'}
                        </button>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div class="space-y-4">
                          <h3 class="text-xs font-black text-slate-400 uppercase flex items-center gap-2 px-2">ğŸ”‘ Cloudflare API å‡­æ®</h3>
                          <div class="p-8 bg-white/40 dark:bg-white/5 rounded-[40px] border border-white/20 space-y-6 shadow-sm">
                              <div class="space-y-2">
                                  <label class="text-[10px] font-black text-blue-600 uppercase tracking-widest ml-1">è´¦æˆ· ID (Account ID)</label>
                                  <input class="w-full bg-white dark:bg-slate-900 border border-slate-200 dark:border-white/10 rounded-2xl px-5 py-4 dark:text-white text-sm font-mono focus:ring-2 ring-blue-500 transition-all outline-none" 
                                      placeholder="Cloudflare Account ID" value=${local.accountId} onInput=${e => setLocal({...local, accountId: e.target.value})} />
                              </div>
                              <div class="space-y-2">
                                  <label class="text-[10px] font-black text-emerald-600 uppercase tracking-widest ml-1">Pages ä»¤ç‰Œ (Pages API Token)</label>
                                  <input type="password" class="w-full bg-white dark:bg-slate-900 border border-slate-200 dark:border-white/10 rounded-2xl px-5 py-4 dark:text-white text-sm font-mono focus:ring-2 ring-emerald-500 transition-all outline-none" 
                                      placeholder="åŒ…å« Pages:Edit æƒé™çš„ Token" value=${local.pagesToken} onInput=${e => setLocal({...local, pagesToken: e.target.value})} />
                              </div>
                              <div class="space-y-2">
                                  <label class="text-[10px] font-black text-orange-600 uppercase tracking-widest ml-1">DNS ä»¤ç‰Œ (Zone API Token)</label>
                                  <input type="password" class="w-full bg-white dark:bg-slate-900 border border-slate-200 dark:border-white/10 rounded-2xl px-5 py-4 dark:text-white text-sm font-mono focus:ring-2 ring-orange-500 transition-all outline-none" 
                                      placeholder="åŒ…å« DNS:Edit æƒé™çš„ Token" value=${local.zoneToken} onInput=${e => setLocal({...local, zoneToken: e.target.value})} />
                              </div>
                          </div>
                        </div>

                        <div class="space-y-4">
                          <h3 class="text-xs font-black text-slate-400 uppercase flex items-center gap-2 px-2">ğŸ¨ é¢æ¿ç•Œé¢è®¾ç½®</h3>
                          <div class="p-8 bg-white/40 dark:bg-white/5 rounded-[40px] border border-white/20 space-y-6 shadow-sm">
                              <div class="space-y-2">
                                  <label class="text-[10px] font-black text-slate-500 uppercase tracking-widest ml-1">åˆ†å‘ä¸»åŸŸå</label>
                                  <input class="w-full bg-white dark:bg-slate-900 border border-slate-200 dark:border-white/10 rounded-2xl px-5 py-4 dark:text-white text-sm font-mono focus:ring-2 ring-purple-500 transition-all outline-none" 
                                      placeholder="ä¾‹å¦‚: hyeri.top" value=${local.parentDomain} onInput=${e => setLocal({...local, parentDomain: e.target.value})} />
                              </div>
                              <div class="space-y-2">
                                  <label class="text-[10px] font-black text-slate-500 uppercase tracking-widest ml-1">èƒŒæ™¯èƒŒæ™¯ç›´é“¾ (å›¾ç‰‡/è§†é¢‘)</label>
                                  <input class="w-full bg-white dark:bg-slate-900 border border-slate-200 dark:border-white/10 rounded-2xl px-5 py-4 dark:text-white text-sm font-mono focus:ring-2 ring-purple-500 transition-all outline-none" 
                                      placeholder="https://.../bg.jpg" value=${local.backgroundUrl} onInput=${e => setLocal({...local, backgroundUrl: e.target.value})} />
                              </div>
                          </div>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <div class="flex items-center justify-between px-2">
                             <h3 class="text-xs font-black text-slate-400 uppercase tracking-widest flex items-center gap-2">ğŸ”— åˆ†å‘è·¯å¾„ç®¡ç† (U1, U2...)</h3>
                             <button onClick=${addPath} class="text-[11px] font-black bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 px-5 py-2 rounded-xl shadow-sm hover:scale-105 transition-all">+ æ–°å¢æ§½ä½</button>
                        </div>
                        <div class="bg-white/40 dark:bg-white/5 rounded-[40px] border border-white/20 overflow-hidden shadow-sm">
                             <table class="w-full text-left text-sm border-collapse">
                                <thead class="bg-slate-100/50 dark:bg-white/5 border-b border-slate-200 dark:border-white/10">
                                    <tr>
                                        <th class="px-8 py-5 font-black text-slate-500 uppercase text-[10px] tracking-widest">æ§½ä½æ ‡ç­¾</th>
                                        <th class="px-8 py-5 font-black text-slate-500 uppercase text-[10px] tracking-widest">è·¯å¾„åç¼€ (Path)</th>
                                        <th class="px-8 py-5"></th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-slate-100 dark:divide-white/5">
                                    ${(local.paths || []).map((p, i) => html`
                                        <tr class="hover:bg-white/60 dark:hover:bg-white/10 transition-colors">
                                            <td class="px-8 py-5 font-bold text-blue-600 dark:text-blue-400">
                                                <input class="bg-transparent outline-none w-full" value=${p.label} onInput=${e => updatePath(i, 'label', e.target.value)} />
                                            </td>
                                            <td class="px-8 py-5 font-mono text-slate-600 dark:text-slate-300">
                                                <input class="bg-transparent outline-none w-full" placeholder="ä¾‹å¦‚: vless-sub" value=${p.value} onInput=${e => updatePath(i, 'value', e.target.value)} />
                                            </td>
                                            <td class="px-8 py-5 text-right">
                                                <button onClick=${() => removePath(i)} class="text-red-400 hover:text-red-600 font-black text-[10px] uppercase">åˆ é™¤</button>
                                            </td>
                                        </tr>
                                    `)}
                                    ${(!local.paths || local.paths.length === 0) && html`<tr><td colspan="3" class="px-8 py-12 text-center text-slate-400 italic font-medium">å°šæœªå®šä¹‰ä»»ä½•è·¯å¾„æ¨¡æ¿</td></tr>`}
                                </tbody>
                             </table>
                        </div>
                    </div>
                </div>
            `;
        };

        // --- ä¸»ç¨‹åº: App ---
        const App = () => {
            const [auth, setAuth] = useState(sessionStorage.getItem('authenticated') === 'true');
            const [tab, setTab] = useState('domains');
            const [isDark, setIsDark] = useState(false);
            const [config, setConfig] = useState({ 
                accountId: '', 
                pagesToken: '', 
                zoneToken: '', 
                backgroundUrl: '', 
                parentDomain: '', 
                paths: [{label:'U1', value:''}] 
            });

            useEffect(() => {
                if (auth) { fetch('/api/config').then(r => r.json()).then(d => d.success && d.config && setConfig(d.config)); }
            }, [auth]);

            useEffect(() => {
                document.documentElement.classList.toggle('dark', isDark);
                const bg = document.getElementById('custom-bg-layer'); if (bg) bg.remove();
                if (config.backgroundUrl) {
                    const isVid = /\.(mp4|webm|mov)(\?|$)/i.test(config.backgroundUrl);
                    const el = document.createElement(isVid ? 'video' : 'img');
                    el.id = 'custom-bg-layer'; el.src = config.backgroundUrl;
                    el.style.opacity = '0';
                    if (isVid) { el.autoplay = el.loop = el.muted = el.playsInline = true; }
                    document.body.appendChild(el); setTimeout(() => el.style.opacity = '1', 50);
                }
            }, [isDark, config.backgroundUrl]);

            if (!auth) return html`<${Login} onLoginSuccess=${() => setAuth(true)} />`;

            return html`
                <div class="flex h-screen w-screen overflow-hidden relative z-10 p-4 max-md:p-2">
                    <div class="w-64 max-md:hidden glass rounded-[32px] p-6 flex flex-col shadow-2xl mr-4 border-white/20">
                        <div class="flex items-center gap-3 mb-12 pl-2">
                            <img src="${APP_LOGO}" class="w-10 h-10 rounded-2xl shadow-lg object-cover" />
                            <h1 class="font-black text-lg dark:text-white tracking-tight">${APP_NAME}</h1>
                        </div>
                        <nav class="flex-1 space-y-3">
                            ${[
                              {id: 'domains', label: 'åŸŸåæ§åˆ¶', icon: 'ğŸŒ'},
                              {id: 'generator', label: 'éšæœºç”Ÿæˆ', icon: 'âœ¨'},
                              {id: 'settings', label: 'é…ç½®ä¸­å¿ƒ', icon: 'âš™ï¸'}
                            ].map(t => html`
                                <button onClick=${() => setTab(t.id)} class="w-full flex items-center gap-4 px-5 py-4 rounded-2xl transition-all duration-300 ${tab === t.id ? 'bg-blue-600 text-white shadow-xl scale-[1.03]' : 'text-slate-500 dark:text-slate-400 hover:bg-white/60 dark:hover:bg-white/10'}">
                                    <span class="text-xl">${t.icon}</span>
                                    <span class="font-black text-sm uppercase tracking-wider">${t.label}</span>
                                </button>
                            `)}
                        </nav>
                        <div class="flex items-center justify-between pt-6 border-t border-slate-200 dark:border-white/10">
                          <button onClick=${() => setIsDark(!isDark)} class="p-3.5 rounded-2xl bg-slate-100 dark:bg-slate-800 text-lg hover:scale-110 active:scale-95 transition-transform">
                              ${isDark ? 'ğŸŒ™' : 'â˜€ï¸'}
                          </button>
                          <span class="text-[9px] font-black text-slate-400 uppercase tracking-[0.2em] opacity-60">Stable v2.5</span>
                        </div>
                    </div>
                    <main class="flex-1 overflow-y-auto p-10 max-md:p-6 glass rounded-[32px] shadow-2xl relative border-white/20 custom-scroll">
                        ${tab === 'domains' && html`<${DomainManager} config=${config} />`}
                        ${tab === 'generator' && html`<${SubdomainGenerator} config=${config} />`}
                        ${tab === 'settings' && html`<${Settings} config=${config} setConfig=${setConfig} />`}
                    </main>
                    ${!config.backgroundUrl && html`<div class="fixed inset-0 -z-20 bg-gradient-to-br from-indigo-50 via-white to-sky-50 dark:from-slate-950 dark:via-slate-900 dark:to-slate-950"></div>`}
                </div>
            `;
        };

        render(html`<${App} />`, document.getElementById('root'));
    </script>
</body>
</html>
